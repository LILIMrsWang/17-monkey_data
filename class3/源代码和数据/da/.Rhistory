writeWorksheetToFile(wirteFilePath,excelData,"Sheet1")
writeWorksheetToFile(wirteFilePath,excelData)
writeWorksheetToFile(wirteFilePath,excelData,"Sheet0")
readFilePath <- "C:/yz/Project/storedata/瑞澄/member/source/aacc3A.xls"
#"C:/yz/Project/storedata/test-member.xlsx"
#
excelObject <- loadWorkbook(readFilePath)
excelData <- readWorksheet(excelObject,"Sheet1")
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
wirteFilePath <- "C:/yz/Project/storedata/瑞澄/member/reshape/aacc3A.xls"
writeWorksheetToFile(wirteFilePath,excelData,"Sheet0")
readFilePath <- "C:/yz/Project/storedata/瑞澄/member/source/aacc3B.xls"
#"C:/yz/Project/storedata/test-member.xlsx"
#
excelObject <- loadWorkbook(readFilePath)
excelData <- readWorksheet(excelObject,"Sheet1")
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
wirteFilePath <- "C:/yz/Project/storedata/瑞澄/member/reshape/aacc3B.xls"
writeWorksheetToFile(wirteFilePath,excelData,"Sheet0")
View(excelData)
View(excelData)
readFilePath <- "C:/yz/Project/storedata/瑞澄/member/source/aacc3B.xls"
excelObject <- loadWorkbook(readFilePath)
excelData <- readWorksheet(excelObject,"Sheet1")
View(excelData)
View(excelData)
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
View(excelData)
View(excelData)
wirteFilePath <- "C:/yz/Project/storedata/瑞澄/member/reshape/aacc3B.xls"
writeWorksheetToFile(wirteFilePath,excelData,"Sheet0")
writeWorksheetToFile(wirteFilePath,excelData,"Sheet0")
wirteFilePath <- "C:/yz/Project/storedata/瑞澄/member/reshape/aacc3B.xls"
writeWorksheetToFile(wirteFilePath,excelData,"Sheet0")
readFilePath <- "C:/yz/Project/storedata/瑞澄/member/source/aacc3B.xls"
#"C:/yz/Project/storedata/test-member.xlsx"
#
excelObject <- loadWorkbook(readFilePath)
excelData <- readWorksheet(excelObject,"Sheet1")
View(excelData)
View(excelData)
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
wirteFilePath <- "C:/yz/Project/storedata/瑞澄/member/reshape/aacc3B.xls"
writeWorksheetToFile(wirteFilePath,excelData,"Sheet0")
readFilePath <- "C:/yz/Project/storedata/瑞澄/member/source/aacc3B.xls"
#"C:/yz/Project/storedata/test-member.xlsx"
#
excelObject <- loadWorkbook(readFilePath)
excelData <- readWorksheet(excelObject,"Sheet1")
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
wirteFilePath <- "C:/yz/Project/storedata/瑞澄/member/reshape/aacc3B.xls"
writeWorksheetToFile(wirteFilePath,excelData,"Sheet0")
readFilePath <- "C:/yz/Project/storedata/瑞澄/member/source/aacc3B.xls"
excelObject <- loadWorkbook(readFilePath)
excelData <- readWorksheet(excelObject,"Sheet1")
source.with.encoding('C:/install/workspace/da/3_exceldata/member.R', encoding='UTF-8', echo=TRUE)
65535*2
options(java.parameters = "-Xmx1024m")
library(XLConnect)
#read
readFilePath <- "C:/yz/Project/storedata/瑞澄/sale/source/aacc20140630.xls"
excelObject <- loadWorkbook(readFilePath)
excelData <- readWorksheet(excelObject,"Sheet1")
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
wirteFilePath <- "C:/yz/Project/storedata/瑞澄/sale/reshape/aacc20140630.xls"
writeWorksheetToFile(wirteFilePath,excelData,"Sheet0")
source.with.encoding('C:/install/workspace/da/3_exceldata/member.R', encoding='UTF-8', echo=TRUE)
source.with.encoding('C:/install/workspace/da/3_exceldata/member.R', encoding='UTF-8', echo=TRUE)
source.with.encoding('C:/install/workspace/da/3_exceldata/member.R', encoding='UTF-8', echo=TRUE)
source.with.encoding('C:/install/workspace/da/3_exceldata/member.R', encoding='UTF-8', echo=TRUE)
source.with.encoding('C:/install/workspace/da/3_exceldata/member.R', encoding='UTF-8', echo=TRUE)
options(java.parameters = "-Xmx4G")
library(XLConnect)
#read
#readFilePath <- "C:/yz/Project/storedata/瑞澄/sale/source/aacc20140630.xls"
readFilePath <- "C:/yz/Project/storedata/瑞澄/sale/source/aacc201407010930.xls"
excelObject <- loadWorkbook(readFilePath)
excelData <- readWorksheet(excelObject,"Sheet1")
options(java.parameters = "-Xmx4G")
library(XLConnect)
readFilePath <- "C:/yz/Project/storedata/瑞澄/sale/source/aacc201407010930.xls"
excelObject <- loadWorkbook(readFilePath)
excelData <- readWorksheet(excelObject,"Sheet1")
excelObject <- loadWorkbook(readFilePath)
excelObject <- loadWorkbook(readFilePath)
options(java.parameters = "-Xmx2048g")
library(XLConnect)
excelObject <- loadWorkbook(readFilePath)
options(java.parameters = "-Xmx1048g")
library(XLConnect)
excelObject <- loadWorkbook(readFilePath)
options(java.parameters = "-Xmx1024m")
library(XLConnect)
excelObject <- loadWorkbook(readFilePath)
library("openxlsx")
install.packages("openxlsx")
library("openxlsx")
readFilePath <- "C:/yz/Project/storedata/瑞澄/sale/source/aacc201407010930.xls"
excelData <- read.xlsx(readFilePath,"Sheet1")
readFilePath <- "C:/yz/Project/storedata/瑞澄/sale/source/aacc201407010930.xlsX"
excelData <- read.xlsx(readFilePath,"Sheet1")
View(excelData)
View(excelData)
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
View(excelData)
View(excelData)
wirteFilePath <- "C:/yz/Project/storedata/瑞澄/sale/reshape/aacc201407010930.xlsx"
?write.xlsx
write.xlsx(excelData,wirteFilePath)
Sys.getenv("R_ZIPCMD", "zip")
Sys.setenv("R_ZIPCMD" = "C:/Rtools/bin/zip.exe")
Sys.getenv("R_ZIPCMD", "zip")
write.xlsx(excelData,wirteFilePath)
readFilePath <- "C:/yz/Project/storedata/瑞澄/sale/source/aacc201409301231.xlsx"
excelData <- read.xlsx(readFilePath,"Sheet1")
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
View(excelData)
View(excelData)
wirteFilePath <- "C:/yz/Project/storedata/瑞澄/sale/reshape/aacc201409301231.xlsx"
write.xlsx(excelData,wirteFilePath)
readFilePath <- "C:/yz/Project/storedata/瑞澄/sale/source/aacc201501010331.xlsx"
excelData <- read.xlsx(readFilePath,"Sheet1")
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
View(excelData)
View(excelData)
wirteFilePath <- "C:/yz/Project/storedata/瑞澄/sale/reshape/aacc201501010331.xlsx"
write.xlsx(excelData,wirteFilePath)
readDir <- "C:/yz/Project/storedata/瑞澄/sale"
wirteDir <- "C:/yz/Project/storedata/瑞澄/reshape"
setPath <- function(fileName){
readFilePath <- paste(readDir,fileName,sep='/')
wirteFilePath <- paste(wirteDir,fileName,sep='/')
}
setPath("aacc201504010630.xlsx")
readFilePath
readFilePath <- "C:/yz/Project/storedata/瑞澄/sale"
wirteFilePath <- "C:/yz/Project/storedata/瑞澄/reshape"
setPath <- function(fileName){
readFilePath <- paste(readDir,fileName,sep='/')
wirteFilePath <- paste(wirteDir,fileName,sep='/')
}
readDir <- "C:/yz/Project/storedata/瑞澄/sale"
wirteDir <- "C:/yz/Project/storedata/瑞澄/reshape"
setPath <- function(fileName){
readFilePath <- paste(readDir,fileName,sep='/')
wirteFilePath <- paste(wirteDir,fileName,sep='/')
return  (list(readFilePath=readFilePath,wirteFilePath=wirteFilePath))
}
readDir <- "C:/yz/Project/storedata/瑞澄/sale"
wirteDir <- "C:/yz/Project/storedata/瑞澄/reshape"
setPath <- function(fileName){
readFilePath <- paste(readDir,fileName,sep='/')
wirteFilePath <- paste(wirteDir,fileName,sep='/')
result <- list(readFilePath=readFilePath,wirteFilePath=wirteFilePath)
return  (result)
}
file.list <- setPath("aacc201504010630.xlsx")
file.list
file.list['readFilePath']
excelData <- read.xlsx(file.list['readFilePath'],"Sheet1")
file.list[['readFilePath']]
file.list
class(file.list['readFilePath'])
class(file.list[['readFilePath']])
excelData <- read.xlsx(file.list[['readFilePath']],"Sheet1")
file.list[['readFilePath']
q
file.list[['readFilePath']]
#set read and write file path
readDir <- "C:/yz/Project/storedata/瑞澄/sale/source"
wirteDir <- "C:/yz/Project/storedata/瑞澄/sale/reshape"
setPath <- function(fileName){
readFilePath <- paste(readDir,fileName,sep='/')
wirteFilePath <- paste(wirteDir,fileName,sep='/')
result <- list(readFilePath=readFilePath,wirteFilePath=wirteFilePath)
return  (result)
}
file.list <- setPath("aacc201504010630.xlsx")
excelData <- read.xlsx(file.list[['readFilePath']],"Sheet1")
View(excelData)
View(excelData)
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
View(excelData)
View(excelData)
write.xlsx(excelData,file.list[['wirteFilePath']])
#set read and write file path
readDir <- "C:/yz/Project/storedata/瑞澄/sale/source"
wirteDir <- "C:/yz/Project/storedata/瑞澄/sale/reshape"
setPath <- function(fileName){
readFilePath <- paste(readDir,fileName,sep='/')
wirteFilePath <- paste(wirteDir,fileName,sep='/')
result <- list(readFilePath=readFilePath,wirteFilePath=wirteFilePath)
return  (result)
}
file.list <- setPath("aacc201507010930.xlsx")
excelData <- read.xlsx(file.list[['readFilePath']],"Sheet1")
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
View(excelData)
View(excelData)
write.xlsx(excelData,file.list[['wirteFilePath']])
#set read and write file path
readDir <- "C:/yz/Project/storedata/瑞澄/sale/source"
wirteDir <- "C:/yz/Project/storedata/瑞澄/sale/reshape"
setPath <- function(fileName){
readFilePath <- paste(readDir,fileName,sep='/')
wirteFilePath <- paste(wirteDir,fileName,sep='/')
result <- list(readFilePath=readFilePath,wirteFilePath=wirteFilePath)
return  (result)
}
file.list <- setPath("aacc201510011231.xlsx")
#set read and write file path
readDir <- "C:/yz/Project/storedata/瑞澄/sale/source"
wirteDir <- "C:/yz/Project/storedata/瑞澄/sale/reshape"
setPath <- function(fileName){
readFilePath <- paste(readDir,fileName,sep='/')
wirteFilePath <- paste(wirteDir,fileName,sep='/')
result <- list(readFilePath=readFilePath,wirteFilePath=wirteFilePath)
return  (result)
}
file.list <- setPath("aacc201510011231.xlsx")
excelData <- read.xlsx(file.list[['readFilePath']],"Sheet1")
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
write.xlsx(excelData,file.list[['wirteFilePath']])
#set read and write file path
readDir <- "C:/yz/Project/storedata/瑞澄/sale/source"
wirteDir <- "C:/yz/Project/storedata/瑞澄/sale/reshape"
setPath <- function(fileName){
readFilePath <- paste(readDir,fileName,sep='/')
wirteFilePath <- paste(wirteDir,fileName,sep='/')
result <- list(readFilePath=readFilePath,wirteFilePath=wirteFilePath)
return  (result)
}
file.list <- setPath("aacc201601010331.xlsx")
excelData <- read.xlsx(file.list[['readFilePath']],"Sheet1")
View(excelData)
View(excelData)
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
View(excelData)
View(excelData)
write.xlsx(excelData,file.list[['wirteFilePath']])
#set read and write file path
readDir <- "C:/yz/Project/storedata/瑞澄/sale/source"
wirteDir <- "C:/yz/Project/storedata/瑞澄/sale/reshape"
setPath <- function(fileName){
readFilePath <- paste(readDir,fileName,sep='/')
wirteFilePath <- paste(wirteDir,fileName,sep='/')
result <- list(readFilePath=readFilePath,wirteFilePath=wirteFilePath)
return  (result)
}
file.list <- setPath("aacc201604010630.xlsx")
excelData <- read.xlsx(file.list[['readFilePath']],"Sheet1")
View(excelData)
View(excelData)
file.list[['readFilePath']]
excelData <- read.xlsx(file.list[['readFilePath']],"Sheet1")
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
View(excelData)
View(excelData)
write.xlsx(excelData,file.list[['wirteFilePath']])
#set read and write file path
readDir <- "C:/yz/Project/storedata/瑞澄/sale/source"
wirteDir <- "C:/yz/Project/storedata/瑞澄/sale/reshape"
setPath <- function(fileName){
readFilePath <- paste(readDir,fileName,sep='/')
wirteFilePath <- paste(wirteDir,fileName,sep='/')
result <- list(readFilePath=readFilePath,wirteFilePath=wirteFilePath)
return  (result)
}
file.list <- setPath("aacc201609011231.xlsx")
#excelObject <- loadWorkbook(readFilePath)
excelData <- read.xlsx(file.list[['readFilePath']],"Sheet1")
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
View(excelData)
View(excelData)
write.xlsx(excelData,file.list[['wirteFilePath']])
#set read and write file path
readDir <- "C:/yz/Project/storedata/瑞澄/sale/source"
wirteDir <- "C:/yz/Project/storedata/瑞澄/sale/reshape"
setPath <- function(fileName){
readFilePath <- paste(readDir,fileName,sep='/')
wirteFilePath <- paste(wirteDir,fileName,sep='/')
result <- list(readFilePath=readFilePath,wirteFilePath=wirteFilePath)
return  (result)
}
file.list <- setPath("aacc206107010930.xlsx")
excelData <- read.xlsx(file.list[['readFilePath']],"Sheet1")
View(excelData)
View(excelData)
excelData <- transform(excelData, memcardno = sprintf('mtm-%s', memcardno))
View(excelData)
View(excelData)
write.xlsx(excelData,file.list[['wirteFilePath']])
readDir <- "C:/install/workspace/da/data"
wirteDir <- "C:/install/workspace/da/data"
setPath <- function(fileName){
readFilePath <- paste(readDir,fileName,sep='/')
wirteFilePath <- paste(wirteDir,fileName,sep='/')
result <- list(readFilePath=readFilePath,wirteFilePath=wirteFilePath)
return  (result)
}
file.list <- setPath("朝阳医院2016年销售数据.xlsx")
excelData <- read.xlsx(readFilePath,"Sheet1")
readFilePath <- file.list[['readFilePath']]
excelData <- read.xlsx(readFilePath,"Sheet1")
excelData <- transform(excelData, "社保卡号" = sprintf('mtm-%s', 社保卡号))
View(excelData)
View(excelData)
excelData <- read.xlsx(readFilePath,"Sheet1")
View(excelData)
View(excelData)
View(excelData)
View(excelData)
excelData <- transform(excelData, "社保卡号" = sprintf('001%s', 社保卡号))
View(excelData)
View(excelData)
excelData <- read.xlsx(readFilePath,"Sheet1")
excelData <- transform(excelData, "社保卡号" = sprintf('001%s28', 社保卡号))
View(excelData)
View(excelData)
View(excelData)
View(excelData)
excelData <- transform(excelData, "商品编码" = sprintf('8%s', 商品编码))
View(excelData)
View(excelData)
wirteFilePath <- file.list[['wirteFilePath']]
wirteFilePath <- file.list[['wirteFilePath']]
write.xlsx(excelData,wirteFilePath)
View(excelData)
View(excelData)
names(excelData) <- c("time","cardno","drugId","drugName",
"saleNumber","virtualmoney","actualmoney")
names(excelData) <- c("time","cardno","drugId","drugName",
"saleNumber","virtualmoney","actualmoney")
View(excelData)
View(excelData)
library(stringr)
test <- str_split_fixed(excelData$time, " ", 2)
View(test)
View(test)
test
test <- str_split_fixed(excelData$time, " ", 1)
test
View(test)
View(test)
?str_split_fixed
test <- str_split_fixed(excelData$time, " ")
test <- str_split_fixed(excelData$time, " ")
test <- str_split(excelData$time, " ")
test
class(test)
time <- str_split_fixed(excelData$time, " ",n=2)
View(time)
View(time)
View(time)
View(time)
View(time)
time
time[1]
time <- str_split_fixed(excelData$time, " ",n=2)
time[1]
time$V1
View(time)
View(time)
time$V1
time
class(time)
time[,1]
timeSplit <- str_split_fixed(excelData$time, " ",n=2)
excelData$time <-timeSplit[,1]
View(excelData)
View(excelData)
class(excelData)
class(excelData$time)
class(excelData$time)
excelData$time <- as.Date(excelData$time,
"%Y-%m-%d")
class(excelData$time)
View(excelData)
View(excelData)
class(excelData$saleNumber)
is.na(excelData)
View(excelData)
View(excelData)
excelData <- excelData[!is.na(excelData$time),]
View(excelData)
View(excelData)
excelData <- excelData[order(excelData$time,decreasing = FALSE),]
View(excelData)
View(excelData)
kpi1 <- excelData[!duplicated(excelData[,c("time","cardno")]),]
View(kpi1)
View(kpi1)
excelData <- excelData[order(excelData$cardno,
decreasing = FALSE),]
View(excelData)
View(excelData)
excelData <- excelData[order(excelData$time,
decreasing = FALSE),]
View(excelData)
View(excelData)
View(kpi1)
View(kpi1)
consumeNumber <- nrow(kpi1)
startTime <- kpi1$time[1]
startTime
endTime <- kpi1$time[nrow(kpi1)]
endTime
day <- endTimestamp -startTimestamp
startTime <- kpi1$time[1]
#最大的时间值
endTime <- kpi1$time[nrow(kpi1)]
day <- endTime -startTime
day
200/30
monthConsume <- consumeNumber / month
month <- day %/% 30
class(day)
as.numberic(day)
as.numeric(day)
day <- as.numeric(endTime -startTime)
month <- day %/% 30
month
monthConsume <- consumeNumber / month
monthConsume
consumeNumber
totalMoney <- sum(inmtm$actualmoney,na.rm=TRUE)
totalMoney <- sum(excelData$actualmoney,na.rm=TRUE)
totalMoney
monthMoney <- totalMoney / month
monthMoney
pct <- totalMoney / consumeNumber
pct
week <- tapply(excelData$actualmoney, format(excelData$time, "%Y-%U"), sum)
week
class(week)
week <- as.data.frame.table(week)
View(week)
View(week)
?tapply
?tapply
week <- as.data.frame.table(week)
names(week) <- c("time","actualmoney")
week$time <- as.character(week$time)
consume.week$timeNumber <- c(1:nrow(week))
week$timeNumber <- c(1:nrow(week))
View(week)
View(week)
week <- as.data.frame.table(week)
View(week)
View(week)
week <- tapply(excelData$actualmoney,
format(excelData$time, "%Y-%U"),
sum)
week <- as.data.frame.table(week)
View(week)
View(week)
names(week) <- c("time","actualmoney")
View(week)
View(week)
class(week$time)
week$time <- as.character(week$time)
week$timeNumber <- c(1:nrow(week))
View(week)
View(week)
plot(week$timeNumber, week$actualmoney,
xlab="时间（年份-第几周）",
ylab="消费金额",
xaxt = "n",
main= paste("每",input$consumeTrendType,"的消费",sep=""),
col="blue",
type="b")
axis(1,at=consume.week$timeNumber, labels=consume.week$time, cex.axis = 1.5)
plot(week$time, week$actualmoney,
xlab="时间（年份-第几周）",
ylab="消费金额",
xaxt = "n",
main= paste("每",input$consumeTrendType,"的消费",sep=""),
col="blue",
type="b")
axis(1,at=consume.week$timeNumber, labels=consume.week$time, cex.axis = 1.5)
plot(week$time, week$actualmoney,
xlab="时间（年份-第几周）",
ylab="消费金额",
xaxt = "n",
main= paste("每",input$consumeTrendType,"的消费",sep=""),
col="blue",
type="b")
axis(1,at=week$timeNumber, labels=week$time, cex.axis = 1.5)
plot(week$timeNumber, week$actualmoney,
xlab="时间（年份-第几周）",
ylab="消费金额",
xaxt = "n",
main= paste("每",input$consumeTrendType,"的消费",sep=""),
col="blue",
type="b")
axis(1,at=week$timeNumber, labels=week$time, cex.axis = 1.5)
plot(week$timeNumber, week$actualmoney,
xlab="时间（年份-第几周）",
ylab="消费金额",
xaxt = "n",
main= "2016年朝阳医院消费曲线",
col="blue",
type="b")
axis(1,at=week$timeNumber, labels=week$time, cex.axis = 1.5)
plot(week$timeNumber, week$actualmoney,
xlab="时间（年份-第几周）",
ylab="消费金额",
xaxt = "n",
main= "2016年朝阳医院消费曲线",
col="blue",
type="b")
axis(1,at=week$timeNumber, labels=week$time, cex.axis = 1.5)
